<!DOCTYPE html>
<html>
<head>
  <title>Webhook Sender with Auth</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flyonui@1.0.0/dist/flyon.min.css">
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen text-white">

<div id="auth" class="bg-gray-800 p-6 rounded-lg shadow-lg w-96">
  <h1 class="text-2xl font-bold mb-4">Login / Register</h1>
  <input type="text" id="username" placeholder="Username" class="w-full p-2 mb-3 rounded bg-gray-700 text-white">
  <input type="password" id="password" placeholder="Password" class="w-full p-2 mb-3 rounded bg-gray-700 text-white">
  <div class="flex gap-2">
    <button onclick="auth('login')" class="bg-blue-500 px-4 py-2 rounded">Login</button>
    <button onclick="auth('register')" class="bg-green-500 px-4 py-2 rounded">Register</button>
  </div>
  <div id="alert"></div>
</div>

<div id="webhook" class="hidden bg-gray-800 p-6 rounded-lg shadow-lg w-96">
  <h1 class="text-2xl font-bold mb-4">Send Message</h1>
  <input type="text" id="webhookUrl" placeholder="Webhook URL" class="w-full p-2 mb-3 rounded bg-gray-700 text-white">
  <textarea id="message" placeholder="Message" rows="4" class="w-full p-2 mb-3 rounded bg-gray-700 text-white"></textarea>
  <button onclick="sendMessage()" class="bg-purple-500 px-4 py-2 rounded">Send</button>
  <div id="status" class="mt-2"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flyonui@1.0.0/dist/flyon.min.js"></script>
<script>
const API_URL = "abn.madoosi.com/V1/Auth/api.php"; // Change if hosted differently

// Auto-login if cookie exists
if (getCookie("username")) {
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("webhook").classList.remove("hidden");
}

function auth(action) {
    let user = document.getElementById("username").value.trim();
    let pass = document.getElementById("password").value.trim();

    if (!user || !pass) {
        flyon.alert("Please fill in both fields.", "danger");
        return;
    }

    let formData = new FormData();
    formData.append("action", action);
    formData.append("username", user);
    formData.append("password", pass);

    fetch(API_URL, { method: "POST", body: formData })
        .then(res => res.json())
        .then(data => {
            flyon.alert(data.message, data.status === "success" ? "success" : "danger");
            if (data.status === "success" && action === "login") {
                setCookie("username", user, 1);
                location.reload();
            }
        })
        .catch(err => flyon.alert("Error: " + err.message, "danger"));
}

function sendMessage() {
    const url = document.getElementById('webhookUrl').value.trim();
    const msg = document.getElementById('message').value.trim();
    if (!url || !msg) {
        flyon.alert("Webhook URL and message are required.", "danger");
        return;
    }
    fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: msg })
    }).then(res => {
        if (res.ok) flyon.alert("Message sent!", "success");
        else flyon.alert("Failed to send message.", "danger");
    }).catch(err => flyon.alert("Error: " + err.message, "danger"));
}

// Cookie helpers
function setCookie(name, value, days) {
    let expires = "";
    if (days) {
        let d = new Date();
        d.setTime(d.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + d.toUTCString();
    }
    document.cookie = name + "=" + value + expires + "; path=/";
}
function getCookie(name) {
    let match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    return match ? match[2] : null;
}
</script>

</body>
</html>
