<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <title>Chat Webhook</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/preline/dist/preline.js"></script>
  <style>
    /* Toast animation */
    .toast-enter {
      transform: translateX(120%);
      opacity: 0;
    }
    .toast-enter-active {
      transform: translateX(0);
      opacity: 1;
      transition: all 0.4s ease;
    }
    .toast-exit {
      opacity: 0;
      transition: opacity 0.4s ease;
    }
  </style>
</head>
<body class="dark:bg-gray-900 dark:text-white min-h-screen flex flex-col">

  <!-- Loading Screen -->
  <div id="loading-screen" class="fixed inset-0 flex items-center justify-center bg-gray-900 text-white text-2xl z-50">
    Loading...
  </div>

  <!-- Navbar -->
  <nav class="bg-gray-800 text-white p-4 flex justify-between">
    <div class="text-lg font-bold">Chat Webhook</div>
    <div class="space-x-4">
      <button onclick="switchTab('webhooks')" class="hover:underline">Webhooks</button>
      <button onclick="switchTab('send')" class="hover:underline">Send</button>
    </div>
  </nav>

  <!-- Pages -->
  <main class="flex-1 p-6">
    <!-- Webhooks Page -->
    <div id="page-webhooks" class="hidden">
      <h2 class="text-xl font-bold mb-4">Manage Webhooks</h2>
      <form id="webhook-form" class="space-y-4">
        <input type="text" id="webhook-name" placeholder="Webhook Name" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600">
        <input type="url" id="webhook-url" placeholder="Webhook URL" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600">
        <button type="submit" class="bg-blue-600 px-4 py-2 rounded text-white">Save Webhook</button>
      </form>
      <ul id="webhook-list" class="mt-6 space-y-2"></ul>
    </div>

    <!-- Send Page -->
    <div id="page-send" class="hidden">
      <h2 class="text-xl font-bold mb-4">Send Message</h2>
      <form id="send-form" class="space-y-4">
        <select id="webhook-select" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600"></select>
        <textarea id="message" rows="4" placeholder="Your message" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600"></textarea>
        <button type="submit" class="bg-green-600 px-4 py-2 rounded text-white">Send</button>
      </form>
    </div>
  </main>

  <!-- Toast Container -->
  <div id="toast-container" class="fixed bottom-4 right-4 flex flex-col items-end space-y-2"></div>

  <script>
    // Loading Screen
    window.addEventListener("load", () => {
      setTimeout(() => {
        document.getElementById("loading-screen").style.display = "none";
        switchTab('webhooks');
      }, 5000);
    });

    // Switch Tabs
    function switchTab(tab) {
      document.querySelectorAll("main > div").forEach(el => el.classList.add("hidden"));
      document.getElementById("page-" + tab).classList.remove("hidden");
    }

    // Toast
    function showToast(message, type = "success") {
      const container = document.getElementById("toast-container");
      const toast = document.createElement("div");
      toast.className = `toast-enter p-4 rounded shadow-md flex items-center space-x-2 ${
        type === "success" ? "bg-green-600 text-white" : "bg-red-600 text-white"
      }`;
      toast.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          ${type === "success"
            ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />'
            : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />'}
        </svg>
        <span>${message}</span>
      `;
      container.prepend(toast);

      // Animate in
      requestAnimationFrame(() => toast.classList.add("toast-enter-active"));

      // Remove after 3s
      setTimeout(() => {
        toast.classList.add("toast-exit");
        setTimeout(() => toast.remove(), 400);
      }, 3000);
    }

    // Webhooks from localStorage
    let webhooks = JSON.parse(localStorage.getItem("webhooks") || "[]");

    function renderWebhooks() {
      const list = document.getElementById("webhook-list");
      const select = document.getElementById("webhook-select");
      list.innerHTML = "";
      select.innerHTML = "";
      webhooks.forEach((w, i) => {
        const li = document.createElement("li");
        li.className = "p-2 bg-gray-700 rounded flex justify-between items-center";
        li.innerHTML = `<span>${w.name}</span>
          <button onclick="deleteWebhook(${i})" class="text-red-400 hover:text-red-600">Delete</button>`;
        list.appendChild(li);

        const option = document.createElement("option");
        option.value = w.url;
        option.textContent = w.name;
        select.appendChild(option);
      });
    }

    document.getElementById("webhook-form").addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("webhook-name").value.trim();
      const url = document.getElementById("webhook-url").value.trim();
      if (!name || !url) return showToast("Fill all fields", "error");
      webhooks.push({ name, url });
      localStorage.setItem("webhooks", JSON.stringify(webhooks));
      renderWebhooks();
      showToast("Webhook saved!", "success");
      e.target.reset();
    });

    function deleteWebhook(i) {
      webhooks.splice(i, 1);
      localStorage.setItem("webhooks", JSON.stringify(webhooks));
      renderWebhooks();
      showToast("Webhook deleted", "success");
    }

    document.getElementById("send-form").addEventListener("submit", e => {
      e.preventDefault();
      const url = document.getElementById("webhook-select").value;
      const msg = document.getElementById("message").value.trim();
      if (!url || !msg) return showToast("Select webhook & enter message", "error");

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: msg })
      }).then(res => {
        if (res.ok) {
          showToast("Message sent!", "success");
          e.target.reset();
        } else {
          showToast("Failed to send", "error");
        }
      });
    });

    renderWebhooks();
  </script>
</body>
</html>
