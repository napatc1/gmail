<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <title>Chat Webhook</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/preline/dist/preline.js"></script>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    /* Loading bar */
    #loadingBar { position: fixed; top: 0; left: 0; height: 4px; background: red; width: 0; transition: width 1s ease; z-index: 9999; }
    #loadingScreen { position: fixed; inset: 0; background: #111; color: white; display: flex; align-items: center; justify-content: center; flex-direction: column; z-index: 9998; }

    /* Fade animation */
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }

    /* SVG animations */
    .check-circle,.x-circle,.warn-circle { stroke: currentColor; stroke-width:2; stroke-dasharray:166; stroke-dashoffset:166; animation: strokeCircle 0.6s ease forwards; }
    .check-path { stroke: currentColor; stroke-width:2; stroke-dasharray:48; stroke-dashoffset:48; animation: strokeCheck 0.4s ease forwards 0.6s; }
    .x-path { stroke: currentColor; stroke-width:2; stroke-dasharray:28; stroke-dashoffset:28; animation: strokeX 0.4s ease forwards 0.6s; }
    .warn-line { stroke: currentColor; stroke-width:2; stroke-dasharray:15; stroke-dashoffset:15; animation: strokeWarn 0.6s ease forwards 0.6s; }
    .warn-dot { fill: currentColor; opacity:0; animation: fadeDot 0.3s ease forwards 1.2s; }
    @keyframes strokeCircle { to { stroke-dashoffset:0; } }
    @keyframes strokeCheck { to { stroke-dashoffset:0; } }
    @keyframes strokeX { to { stroke-dashoffset:0; } }
    @keyframes strokeWarn { to { stroke-dashoffset:0; } }
    @keyframes fadeDot { to { opacity:1; } }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

<!-- 🔴 Loading Screen -->
<div id="loadingScreen">
  <div id="loadingBar"></div>
  <p class="mt-6 text-xl">Loading...</p>
</div>

<!-- 🔝 Navbar -->
<nav class="flex space-x-4 p-4 bg-gray-800">
  <button onclick="switchTab('webhooks')" class="tab-btn px-3 py-2 rounded bg-gray-700">Webhooks</button>
  <button onclick="switchTab('editor')" class="tab-btn px-3 py-2 rounded">Editor</button>
  <button onclick="switchTab('send')" class="tab-btn px-3 py-2 rounded">Send</button>
</nav>

<!-- 📄 Pages -->
<div id="pages" class="p-6">
  <!-- Webhook Manager -->
  <div id="webhooks" class="page">
    <h2 class="text-xl mb-3">Manage Webhooks</h2>
    <form onsubmit="saveWebhook(event)" class="space-y-3">
      <input id="webhookName" class="w-full p-2 rounded bg-gray-800 border border-gray-700" placeholder="Webhook Name" required>
      <input id="webhookUrl" class="w-full p-2 rounded bg-gray-800 border border-gray-700" placeholder="Webhook URL" required>
      <button class="bg-blue-600 px-4 py-2 rounded">Save</button>
    </form>
    <ul id="webhookList" class="mt-4 space-y-2"></ul>
  </div>

  <!-- Editor -->
  <div id="editor" class="page hidden">
    <h2 class="text-xl mb-3">Message Editor</h2>
    <div id="quillEditor" class="bg-gray-800 text-white rounded h-40"></div>
    <div class="mt-4 p-3 bg-gray-800 rounded">
      <h3 class="font-semibold">Preview:</h3>
      <div id="preview" class="mt-2"></div>
    </div>
  </div>

  <!-- Send -->
  <div id="send" class="page hidden">
    <h2 class="text-xl mb-3">Send Message</h2>
    <select id="selectedWebhook" class="w-full p-2 rounded bg-gray-800 border border-gray-700 mb-3"></select>
    <button onclick="sendMessage()" class="bg-green-600 px-4 py-2 rounded">Send Message</button>
  </div>
</div>

<!-- ✅ Toast Container -->
<div id="toast-container" class="fixed bottom-4 right-4 flex flex-col space-y-3 z-50"></div>

<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
// === Loading screen logic (1/day) ===
const lastLoad = localStorage.getItem("lastLoad");
if (lastLoad && Date.now()-lastLoad < 86400000) {
  document.getElementById("loadingScreen").style.display="none";
} else {
  localStorage.setItem("lastLoad", Date.now());
  const bar = document.getElementById("loadingBar");
  let w = 0;
  const interval = setInterval(()=> {
    w+=10; bar.style.width=w+"%";
    if(w>=100){ clearInterval(interval); setTimeout(()=>{document.getElementById("loadingScreen").style.display="none";},500);}
  },150);
}

// === Quill editor ===
const quill = new Quill("#quillEditor", { theme:"snow" });
document.querySelector(".ql-toolbar").classList.add("bg-gray-800","text-white");
quill.on("text-change", ()=> { document.getElementById("preview").innerHTML = quill.root.innerHTML; });

// === Page switching ===
function switchTab(tab){
  document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));
  document.getElementById(tab).classList.remove("hidden");
  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("bg-gray-700"));
  event.target.classList.add("bg-gray-700");
}

// === Webhook storage (cookies) ===
function getWebhooks(){
  const c=document.cookie.split("; ").find(r=>r.startsWith("webhooks="));
  return c?JSON.parse(decodeURIComponent(c.split("=")[1])):[];
}
function saveWebhook(e){
  e.preventDefault();
  let name=document.getElementById("webhookName").value;
  let url=document.getElementById("webhookUrl").value;
  let hooks=getWebhooks(); hooks.push({name,url});
  document.cookie="webhooks="+encodeURIComponent(JSON.stringify(hooks))+"; path=/";
  loadWebhooks(); showToast("success","Webhook saved!");
  e.target.reset();
}
function loadWebhooks(){
  const hooks=getWebhooks(); let list=document.getElementById("webhookList"), select=document.getElementById("selectedWebhook");
  list.innerHTML=""; select.innerHTML="";
  hooks.forEach((h,i)=>{
    list.innerHTML+=`<li class="p-2 bg-gray-800 rounded">${h.name}</li>`;
    select.innerHTML+=`<option value="${h.url}">${h.name}</option>`;
  });
}
loadWebhooks();

// === Sending messages ===
function sendMessage(){
  let hook=document.getElementById("selectedWebhook").value;
  let msg=quill.root.innerHTML;
  if(!hook){ showToast("error","No webhook selected!"); return; }
  // Simulated POST (replace with fetch)
  console.log("POST to",hook,"msg:",msg);
  showToast("success","Message sent!");
}

// === Toast system with SVG ===
function showToast(type,message){
  const container=document.getElementById("toast-container");
  let svg="";
  if(type==="success"){svg=`<svg class="w-6 h-6 text-green-500" viewBox="0 0 52 52"><circle class="check-circle" cx="26" cy="26" r="25" fill="none"/><path class="check-path" fill="none" d="M14 27l7 7 16-16"/></svg>`;}
  else if(type==="error"){svg=`<svg class="w-6 h-6 text-red-500" viewBox="0 0 52 52"><circle class="x-circle" cx="26" cy="26" r="25" fill="none"/><path class="x-path" fill="none" d="M16 16 36 36"/><path class="x-path" fill="none" d="M36 16 16 36"/></svg>`;}
  else if(type==="warning"){svg=`<svg class="w-6 h-6 text-yellow-500" viewBox="0 0 52 52"><circle class="warn-circle" cx="26" cy="26" r="25" fill="none"/><line class="warn-line" x1="26" y1="15" x2="26" y2="30"/><circle class="warn-dot" cx="26" cy="37" r="2"/></svg>`;}
  const toast=document.createElement("div");
  toast.className="flex items-center p-3 rounded shadow bg-gray-800 text-white animate-fade-in";
  toast.innerHTML=`<div class="mr-3">${svg}</div><div>${message}</div><button onclick="this.parentElement.remove()" class="ml-4 text-xl">&times;</button>`;
  container.appendChild(toast);
  setTimeout(()=>{if(toast.parentElement)toast.remove();},4000);
}
</script>
</body>
</html>
