<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Spaces Webhook Manager</title>
<script src="https://cdn.tailwindcss.com"></script>

<!-- Quill -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<style>
/* Dark mode for Quill */
.ql-container { background-color: #2d2d2d; color: #f0f0f0; }
.ql-toolbar { background-color: #1e1e1e; border-bottom: 1px solid #444; }
.ql-toolbar button { color: #f0f0f0; }
.ql-editor { background-color: #2d2d2d; color: #f0f0f0; min-height:100px; }
.ql-editor a { color: #1e90ff; }
.ql-picker { background-color: #1e1e1e; color: #f0f0f0; }
.ql-picker-item { background-color: #1e1e1e; color: #f0f0f0; }

/* Alert animation */
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
.animate-fade-in { animation: fadeIn 0.3s ease-out; }
</style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

<!-- Navbar -->
<div class="flex bg-gray-800 p-3 shadow-lg">
  <button id="btnManage" class="px-4 py-2 font-bold text-red-500 border-b-2 border-red-500">Manage Webhooks</button>
  <button id="btnSend" class="px-4 py-2 ml-2 font-bold text-gray-300 hover:text-red-500">Send Messages</button>
</div>

<div class="flex-1 p-6">

  <!-- Manage Webhooks -->
  <div id="manage" class="tab">
    <h1 class="text-2xl font-bold text-red-500 mb-6">Manage Webhooks</h1>
    <div class="w-full max-w-md bg-gray-800 p-6 rounded shadow-lg mb-6">
      <form id="webhookForm" class="space-y-4">
        <div>
          <label class="block mb-1 font-semibold">Name</label>
          <input type="text" id="name" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Your name" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold">Webhook URL</label>
          <input type="url" id="webhook" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Webhook URL" required>
        </div>
        <div>
          <label class="block mb-1 font-semibold">Default Message</label>
          <textarea id="message" rows="3" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Message to send"></textarea>
        </div>
        <button type="submit" class="w-full py-2 px-4 bg-red-500 hover:bg-red-600 rounded text-white font-bold transition-all duration-200">Save Webhook</button>
      </form>
    </div>
    <div class="w-full max-w-md bg-gray-800 p-4 rounded shadow-lg">
      <h2 class="text-lg font-bold text-red-500 mb-4">Saved Webhooks</h2>
      <ul id="webhookList" class="space-y-2"></ul>
    </div>
  </div>

  <!-- Send Messages -->
  <div id="send" class="tab hidden">
    <h1 class="text-2xl font-bold text-red-500 mb-6">Send Messages</h1>
    <div class="w-full max-w-md bg-gray-800 p-6 rounded shadow-lg mb-4">
      <label class="block mb-1 font-semibold">Select Webhook</label>
      <select id="webhookSelect" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 mb-4"></select>

      <label class="block mb-1 font-semibold">Message</label>
      <div id="editor"></div>

      <label class="block mb-1 font-semibold mt-2">Schedule (minutes from now)</label>
      <input type="number" id="scheduleTime" class="w-full px-3 py-2 rounded bg-gray-700 text-gray-100 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 mb-2" placeholder="0 for immediate send">

      <h2 class="font-semibold text-gray-200 mb-1 mt-2">Live Preview:</h2>
      <div id="preview" class="w-full min-h-[100px] p-3 rounded bg-gray-900 border border-gray-600 text-gray-100 mb-4"></div>

      <button id="sendBtn" class="w-full py-2 px-4 bg-red-500 hover:bg-red-600 rounded text-white font-bold transition-all duration-200">Send / Schedule</button>
    </div>

    <div class="w-full max-w-md bg-gray-800 p-4 rounded shadow-lg">
      <h2 class="text-lg font-bold text-red-500 mb-4">Scheduled Messages</h2>
      <ul id="scheduledList" class="space-y-2"></ul>
    </div>
  </div>
</div>

<!-- Alert container -->
<div id="alert-container" class="fixed bottom-4 right-4 flex flex-col space-y-3 z-50"></div>

<script>
// Alerts
function showAlert(type,message){
  const container=document.getElementById("alert-container");
  let icon="",color="";
  if(type==="success"){color="bg-green-100 border-green-500 text-green-700"; icon='<svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8.414 8.414a1 1 0 01-1.414 0L3.293 11.12a1 1 0 011.414-1.414l3.172 3.172 7.707-7.707a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>'}
  else if(type==="error"){color="bg-red-100 border-red-500 text-red-700"; icon='<svg class="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-5h2v2h-2v-2zm0-6h2v4h-2V7z" clip-rule="evenodd"/></svg>'}
  const alert=document.createElement("div");
  alert.className=`flex items-center p-3 border-l-4 rounded shadow ${color} animate-fade-in`;
  alert.innerHTML=`<div class="mr-2">${icon}</div><div class="flex-1">${message}</div><button onclick="this.parentElement.remove()" class="ml-3 text-xl font-bold leading-none focus:outline-none">&times;</button>`;
  container.appendChild(alert);
  setTimeout(()=>{if(alert.parentElement) alert.remove()},4000);
}

// Cookies
function setCookie(name,value,days){const d=new Date();d.setTime(d.getTime()+(days*24*60*60*1000));document.cookie=name+"="+encodeURIComponent(value)+";path=/;expires="+d.toUTCString();}
function getCookie(name){const v=document.cookie.match('(^|;) ?'+name+'=([^;]*)(;|$)'); return v?decodeURIComponent(v[2]):null;}

// Load webhooks
function loadWebhooks(){
  const list=document.getElementById("webhookList");
  const select=document.getElementById("webhookSelect");
  list.innerHTML=""; select.innerHTML="";
  const saved=getCookie("chatWebhooks");
  if(saved){
    const webhooks=JSON.parse(saved);
    webhooks.forEach((wh,index)=>{
      const li=document.createElement("li");
      li.className="p-2 bg-gray-700 rounded flex justify-between items-center";
      li.innerHTML=`<span>${wh.name}: ${wh.webhook}</span>
                    <button onclick="removeWebhook(${index})" class="bg-red-500 px-2 py-1 rounded text-sm">Delete</button>`;
      list.appendChild(li);
      const option=document.createElement("option");
      option.value=index;
      option.text=`${wh.name}`;
      select.appendChild(option);
    });
  }
}

// Remove webhook
function removeWebhook(index){
  let webhooks=getCookie("chatWebhooks")?JSON.parse(getCookie("chatWebhooks")):[];
  webhooks.splice(index,1);
  setCookie("chatWebhooks",JSON.stringify(webhooks),365);
  loadWebhooks();
  showAlert("success","Webhook deleted.");
}

// Form submit
document.getElementById("webhookForm").addEventListener("submit",function(e){
  e.preventDefault();
  const name=document.getElementById("name").value.trim();
  const webhook=document.getElementById("webhook").value.trim();
  const message=document.getElementById("message").value.trim();
  if(!name||!webhook){showAlert("error","Name and Webhook required!");return;}
  let webhooks=getCookie("chatWebhooks")?JSON.parse(getCookie("chatWebhooks")):[];
  webhooks.push({name,webhook,message});
  setCookie("chatWebhooks",JSON.stringify(webhooks),365);
  loadWebhooks();
  showAlert("success","Webhook saved!");
  this.reset();
});

// Initialize Quill
var quill = new Quill('#editor', {
  theme: 'snow',
  modules: {
    toolbar: [
      [{ 'header': [1, 2, false] }],
      ['bold', 'italic', 'underline'],
      ['link', 'blockquote', 'image'],
      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
      [{ 'align': [] }],
      [{ 'color': [] }]
    ]
  }
});

// Live preview
function updatePreview(){document.getElementById("preview").innerHTML=quill.root.innerHTML;}
quill.on('text-change', updatePreview);

// Tab switching using addEventListener
document.getElementById("btnManage").addEventListener("click", ()=>switchTab('manage'));
document.getElementById("btnSend").addEventListener("click", ()=>switchTab('send'));

function switchTab(tab){
  document.querySelectorAll(".tab").forEach(t=>t.classList.add("hidden"));
  document.getElementById(tab).classList.remove("hidden");
  // Update navbar button styles
  document.querySelectorAll(".flex > button").forEach(btn=>{
    btn.classList.remove("border-b-2","text-red-500");
    btn.classList.add("text-gray-300");
  });
  document.getElementById(tab==='manage'?'btnManage':'btnSend').classList.add("border-b-2","border-red-500","text-red-500");
}

// Schedule system
function scheduleMessage(){
  const select=document.getElementById("webhookSelect");
  const text=quill.root.innerHTML.trim();
  const minutes=parseInt(document.getElementById("scheduleTime").value||0);
  if(select.value===""){showAlert("error","Select a webhook!"); return;}
  if(!text){showAlert("error","Enter a message!"); return;}
  const webhooks=JSON.parse(getCookie("chatWebhooks")||"[]");
  const wh=webhooks[select.value];
  const scheduled=JSON.parse(localStorage.getItem("scheduledMessages")||"[]");
  const sendTime=Date.now() + minutes*60*1000;
  scheduled.push({webhook:wh.webhook,content:text,time:sendTime});
  localStorage.setItem("scheduledMessages",JSON.stringify(scheduled));
  showAlert("success", minutes>0 ? "Message scheduled!" : "Message sent immediately!");
  updateScheduledList();
  if(minutes===0) sendScheduledMessages();
  quill.setContents([]);
  updatePreview();
}

document.getElementById("sendBtn").addEventListener("click", scheduleMessage);

// Update scheduled list
function updateScheduledList(){
  const list=document.getElementById("scheduledList");
  list.innerHTML="";
  const scheduled=JSON.parse(localStorage.getItem("scheduledMessages")||"[]");
  scheduled.forEach((s,i)=>{
    const li=document.createElement("li");
    li.className="p-2 bg-gray-700 rounded flex justify-between items-center";
    const date=new Date(s.time).toLocaleTimeString();
    li.innerHTML=`<span>${s.content} (to send at ${date})</span>
                  <button onclick="removeScheduled(${i})" class="bg-red-500 px-2 py-1 rounded text-sm">Cancel</button>`;
    list.appendChild(li);
  });
}

// Remove scheduled
function removeScheduled(index){
  const scheduled=JSON.parse(localStorage.getItem("scheduledMessages")||"[]");
  scheduled.splice(index,1);
  localStorage.setItem("scheduledMessages",JSON.stringify(scheduled));
  updateScheduledList();
}

// Send due messages (mock fetch)
async function sendScheduledMessages(){
  let scheduled=JSON.parse(localStorage.getItem("scheduledMessages")||"[]");
  const now=Date.now();
  const toSend=scheduled.filter(s=>s.time<=now);
  for(const s of toSend){
    try{ 
      await fetch(s.webhook,{
        method:"POST",
        headers:{"Content-Type":"application/json"}, 
        body:JSON.stringify({content:s.content})
      });
    } catch(err){ console.error(err);}
  }
  scheduled=scheduled.filter(s=>s.time>now);
  localStorage.setItem("scheduledMessages",JSON.stringify(scheduled));
  updateScheduledList();
}

// Initialize
loadWebhooks();
updateScheduledList();
setInterval(sendScheduledMessages,60000);
updatePreview();
</script>
</body>
</html>
